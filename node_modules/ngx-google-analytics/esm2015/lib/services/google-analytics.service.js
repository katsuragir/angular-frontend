/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, Inject } from '@angular/core';
import { NGX_GOOGLE_ANALYTICS_SETTINGS_TOKEN } from '../tokens/ngx-google-analytics-settings-token';
import * as i0 from "@angular/core";
import * as i1 from "../tokens/ngx-google-analytics-settings-token";
export class GoogleAnalyticsService {
    /**
     * @param {?} $trackingId
     */
    constructor($trackingId) {
        this.$trackingId = $trackingId;
    }
    /**
     * @protected
     * @param {?} err
     * @return {?}
     */
    throw(err) {
        if (console && console.error) {
            console.error(err);
        }
    }
    /**
     * Call native GA Tag
     *
     * @param {?} action config|event
     * @param {?} command Action specialization
     * @param {...?} options Command configuration
     * @return {?}
     */
    gtag(action, command, ...options) {
        try {
            window['gtag'](action, command, ...options);
        }
        catch (err) {
            this.throw(err);
        }
    }
    /**
     * Send an event trigger to GA. It is the same as call:
     * ```js
     * gtag('event', 'video_auto_play_start', {
     *   'event_label': 'My promotional video',
     *   'event_category': 'video_auto_play'
     * });
     * ```
     *
     * @param {?} action 'video_auto_play_start'
     * @param {?=} category 'video_auto_play'
     * @param {?=} label 'My promotional video'
     * @param {?=} value An value to measure something
     * @param {?=} interaction
     * @return {?}
     */
    event(action, category, label, value, interaction) {
        try {
            if (window['gtag']) {
                /** @type {?} */
                const opt = {};
                if (category) {
                    opt['event_category'] = category;
                }
                if (label) {
                    opt['event_label'] = label;
                }
                if (value) {
                    opt['value'] = value;
                }
                if (interaction !== undefined) {
                    opt['interaction'] = interaction;
                }
                this.gtag('event', (/** @type {?} */ (action)), opt);
            }
        }
        catch (error) {
            this.throw(error);
        }
    }
    /**
     * Send an page view event. This is the same as
     *
     * ```js
     * gtag('config', 'GA_TRACKING_ID', {
     *   'page_title' : 'Homepage',
     *   'page_path': '/home'
     * });
     * ```
     *
     * The tracking ID is injected automatically by Inject Token NGX_GOOGLE_ANALYTICS_SETTINGS_TOKEN
     *
     * @param {?=} path /home
     * @param {?=} title Homepage
     * @param {?=} location '{ page_location }'
     * @param {?=} options '{ ... custom dimentions }'
     * @return {?}
     */
    pageView(path, title, location, options) {
        try {
            if (window['gtag']) {
                /** @type {?} */
                const opt = {};
                if (path) {
                    opt['page_path'] = path;
                }
                if (title) {
                    opt['page_title'] = title;
                }
                if (location) {
                    opt['page_location'] = location;
                }
                if (options) {
                    Object.assign(opt, options);
                }
                this.gtag('config', this.$trackingId.trackingCode, opt);
            }
        }
        catch (error) {
            this.throw(error);
        }
    }
    /**
     * Send an evento to report a App Page View. It is the same as
     *
     * ```js
     * gtag('event', 'screen_view', {
     *   'app_name': 'myAppName',
     *   'screen_name' : 'Home'
     * });
     *
     * ```
     *
     * @param {?} screen 'screen_name'
     * @param {?} appName
     * @param {?=} appId 'app_id'
     * @param {?=} appVersion 'app_version'
     * @param {?=} installerId 'app_installer_id'
     * @return {?}
     */
    appView(screen, appName, appId, appVersion, installerId) {
        try {
            if (window['gtag']) {
                /** @type {?} */
                const opt = {};
                if (screen) {
                    opt['screen_name'] = screen;
                }
                if (appName) {
                    opt['app_name'] = appName;
                }
                if (appId) {
                    opt['app_id'] = appId;
                }
                if (appVersion) {
                    opt['app_version'] = appVersion;
                }
                if (installerId) {
                    opt['app_installer_id'] = installerId;
                }
                this.gtag('event', 'screen_view', opt);
            }
        }
        catch (error) {
            this.throw(error);
        }
    }
    /**
     * Send an event to GA to report an application error. It is the same as
     *
     * ```js
     * gtag('event', 'exception', {
     *   'description': 'error_description',
     *   'fatal': false   // set to true if the error is fatal
     * });
     * ```
     *
     * @param {?=} description 'error_description'
     * @param {?=} fatal set to true if the error is fatal
     * @return {?}
     */
    exception(description, fatal) {
        try {
            if (window['gtag']) {
                /** @type {?} */
                const opt = {};
                if (description) {
                    opt['description'] = description;
                }
                if (fatal) {
                    opt['fatal'] = fatal;
                }
                this.gtag('event', 'exception', opt);
            }
        }
        catch (error) {
            this.throw(error);
        }
    }
}
GoogleAnalyticsService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
GoogleAnalyticsService.ctorParameters = () => [
    { type: undefined, decorators: [{ type: Inject, args: [NGX_GOOGLE_ANALYTICS_SETTINGS_TOKEN,] }] }
];
/** @nocollapse */ GoogleAnalyticsService.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: function GoogleAnalyticsService_Factory() { return new GoogleAnalyticsService(i0.ɵɵinject(i1.NGX_GOOGLE_ANALYTICS_SETTINGS_TOKEN)); }, token: GoogleAnalyticsService, providedIn: "root" });
if (false) {
    /**
     * @type {?}
     * @protected
     */
    GoogleAnalyticsService.prototype.$trackingId;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ29vZ2xlLWFuYWx5dGljcy5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LWdvb2dsZS1hbmFseXRpY3MvIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvZ29vZ2xlLWFuYWx5dGljcy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNuRCxPQUFPLEVBQUUsbUNBQW1DLEVBQUUsTUFBTSwrQ0FBK0MsQ0FBQzs7O0FBTXBHLE1BQU0sT0FBTyxzQkFBc0I7Ozs7SUFFakMsWUFDeUQsV0FBcUM7UUFBckMsZ0JBQVcsR0FBWCxXQUFXLENBQTBCO0lBQzFGLENBQUM7Ozs7OztJQUVLLEtBQUssQ0FBQyxHQUFVO1FBQ3hCLElBQUksT0FBTyxJQUFJLE9BQU8sQ0FBQyxLQUFLLEVBQUU7WUFDNUIsT0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztTQUNwQjtJQUNILENBQUM7Ozs7Ozs7OztJQVNELElBQUksQ0FBQyxNQUFjLEVBQUUsT0FBZSxFQUFFLEdBQUcsT0FBbUI7UUFDMUQsSUFBSTtZQUNGLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLEVBQUUsT0FBTyxFQUFFLEdBQUcsT0FBTyxDQUFDLENBQUM7U0FDN0M7UUFBQyxPQUFPLEdBQUcsRUFBRTtZQUNaLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7U0FDakI7SUFDSCxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7OztJQWdCRCxLQUFLLENBQUMsTUFBeUIsRUFBRSxRQUFpQixFQUFFLEtBQWMsRUFBRSxLQUFjLEVBQUUsV0FBcUI7UUFDdkcsSUFBSTtZQUNGLElBQUksTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFOztzQkFDWixHQUFHLEdBQUcsRUFBRTtnQkFDZCxJQUFJLFFBQVEsRUFBRTtvQkFDWixHQUFHLENBQUMsZ0JBQWdCLENBQUMsR0FBRyxRQUFR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QztpQkFDbEM7Z0JBQ0QsSUFBSSxLQUFLLEVBQUU7b0JBQ1QsR0FBRyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEtBQUssQ0FBQztpQkFDdEI7Z0JBQ0QsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsV0FBVyxFQUFFLEdBQUcsQ0FBQyxDQUFDO2FBQ3RDO1NBQ0Y7UUFBQyxPQUFPLEtBQUssRUFBRTtZQUNkLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDbkI7SUFDSCxDQUFDOzs7WUFsTEYsVUFBVSxTQUFDO2dCQUNWLFVBQVUsRUFBRSxNQUFNO2FBQ25COzs7OzRDQUlJLE1BQU0sU0FBQyxtQ0FBbUM7Ozs7Ozs7O0lBQTNDLDZDQUE0RiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIEluamVjdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBOR1hfR09PR0xFX0FOQUxZVElDU19TRVRUSU5HU19UT0tFTiB9IGZyb20gJy4uL3Rva2Vucy9uZ3gtZ29vZ2xlLWFuYWx5dGljcy1zZXR0aW5ncy10b2tlbic7XHJcbmltcG9ydCB7IElHb29nbGVBbmFseXRpY3NTZXR0aW5ncyB9IGZyb20gJy4uL2ludGVyZmFjZXMvaS1nb29nbGUtYW5hbHl0aWNzLXNldHRpbmdzJztcclxuaW1wb3J0IHsgR2FBY3Rpb24gfSBmcm9tICcuLi90eXBlcy9nYS1hY3Rpb24udHlwZSc7XHJcbkBJbmplY3RhYmxlKHtcclxuICBwcm92aWRlZEluOiAncm9vdCdcclxufSlcclxuZXhwb3J0IGNsYXNzIEdvb2dsZUFuYWx5dGljc1NlcnZpY2Uge1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIEBJbmplY3QoTkdYX0dPT0dMRV9BTkFMWVRJQ1NfU0VUVElOR1NfVE9LRU4pIHByb3RlY3RlZCAkdHJhY2tpbmdJZDogSUdvb2dsZUFuYWx5dGljc1NldHRpbmdzXHJcbiAgKSB7IH1cclxuXHJcbiAgcHJvdGVjdGVkIHRocm93KGVycjogRXJyb3IpIHtcclxuICAgIGlmIChjb25zb2xlICYmIGNvbnNvbGUuZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2FsbCBuYXRpdmUgR0EgVGFnXHJcbiAgICpcclxuICAgKiBAcGFyYW0gYWN0aW9uIGNvbmZpZ3xldmVudFxyXG4gICAqIEBwYXJhbSBjb21tYW5kIEFjdGlvbiBzcGVjaWFsaXphdGlvblxyXG4gICAqIEBwYXJhbSBvcHRpb25zIENvbW1hbmQgY29uZmlndXJhdGlvblxyXG4gICAqL1xyXG4gIGd0YWcoYWN0aW9uOiBzdHJpbmcsIGNvbW1hbmQ6IHN0cmluZywgLi4ub3B0aW9uczogQXJyYXk8YW55Pikge1xyXG4gICAgdHJ5IHtcclxuICAgICAgd2luZG93WydndGFnJ10oYWN0aW9uLCBjb21tYW5kLCAuLi5vcHRpb25zKTtcclxuICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICB0aGlzLnRocm93KGVycik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZW5kIGFuIGV2ZW50IHRyaWdnZXIgdG8gR0EuIEl0IGlzIHRoZSBzYW1lIGFzIGNhbGw6XHJcbiAgICogYGBganNcclxuICAgKiBndGFnKCdldmVudCcsICd2aWRlb19hdXRvX3BsYXlfc3RhcnQnLCB7XHJcbiAgICogICAnZXZlbnRfbGFiZWwnOiAnTXkgcHJvbW90aW9uYWwgdmlkZW8nLFxyXG4gICAqICAgJ2V2ZW50X2NhdGVnb3J5JzogJ3ZpZGVvX2F1dG9fcGxheSdcclxuICAgKiB9KTtcclxuICAgKiBgYGBcclxuICAgKlxyXG4gICAqIEBwYXJhbSBhY3Rpb24gJ3ZpZGVvX2F1dG9fcGxheV9zdGFydCdcclxuICAgKiBAcGFyYW0gY2F0ZWdvcnkgJ3ZpZGVvX2F1dG9fcGxheSdcclxuICAgKiBAcGFyYW0gbGFiZWwgJ015IHByb21vdGlvbmFsIHZpZGVvJ1xyXG4gICAqIEBwYXJhbSB2YWx1ZSBBbiB2YWx1ZSB0byBtZWFzdXJlIHNvbWV0aGluZ1xyXG4gICAqL1xyXG4gIGV2ZW50KGFjdGlvbjogR2FBY3Rpb24gfCBzdHJpbmcsIGNhdGVnb3J5Pzogc3RyaW5nLCBsYWJlbD86IHN0cmluZywgdmFsdWU/OiBudW1iZXIsIGludGVyYWN0aW9uPzogYm9vbGVhbikge1xyXG4gICAgdHJ5IHtcclxuICAgICAgaWYgKHdpbmRvd1snZ3RhZyddKSB7XHJcbiAgICAgICAgY29uc3Qgb3B0ID0ge307XHJcbiAgICAgICAgaWYgKGNhdGVnb3J5KSB7XHJcbiAgICAgICAgICBvcHRbJ2V2ZW50X2NhdGVnb3J5J10gPSBjYXRlZ29yeTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGxhYmVsKSB7XHJcbiAgICAgICAgICBvcHRbJ2V2ZW50X2xhYmVsJ10gPSBsYWJlbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHZhbHVlKSB7XHJcbiAgICAgICAgICBvcHRbJ3ZhbHVlJ10gPSB2YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGludGVyYWN0aW9uICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgIG9wdFsnaW50ZXJhY3Rpb24nXSA9IGludGVyYWN0aW9uO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmd0YWcoJ2V2ZW50JywgYWN0aW9uIGFzIHN0cmluZywgb3B0KTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhpcy50aHJvdyhlcnJvcik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZW5kIGFuIHBhZ2UgdmlldyBldmVudC4gVGhpcyBpcyB0aGUgc2FtZSBhc1xyXG4gICAqXHJcbiAgICogYGBganNcclxuICAgKiBndGFnKCdjb25maWcnLCAnR0FfVFJBQ0tJTkdfSUQnLCB7XHJcbiAgICogICAncGFnZV90aXRsZScgOiAnSG9tZXBhZ2UnLFxyXG4gICAqICAgJ3BhZ2VfcGF0aCc6ICcvaG9tZSdcclxuICAgKiB9KTtcclxuICAgKiBgYGBcclxuICAgKlxyXG4gICAqIFRoZSB0cmFja2luZyBJRCBpcyBpbmplY3RlZCBhdXRvbWF0aWNhbGx5IGJ5IEluamVjdCBUb2tlbiBOR1hfR09PR0xFX0FOQUxZVElDU19TRVRUSU5HU19UT0tFTlxyXG4gICAqXHJcbiAgICogQHBhcmFtIHBhdGggL2hvbWVcclxuICAgKiBAcGFyYW0gdGl0bGUgSG9tZXBhZ2VcclxuICAgKiBAcGFyYW0gbG9jYXRpb24gJ3sgcGFnZV9sb2NhdGlvbiB9J1xyXG4gICAqIEBwYXJhbSBvcHRpb25zICd7IC4uLiBjdXN0b20gZGltZW50aW9ucyB9J1xyXG4gICAqL1xyXG4gIHBhZ2VWaWV3KCBwYXRoPzogc3RyaW5nLCB0aXRsZT86IHN0cmluZywgbG9jYXRpb24/OiBzdHJpbmcsIG9wdGlvbnM/OiBPYmplY3QpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGlmICh3aW5kb3dbJ2d0YWcnXSkge1xyXG4gICAgICAgIGNvbnN0IG9wdCA9IHt9O1xyXG4gICAgICAgIGlmIChwYXRoKSB7XHJcbiAgICAgICAgICBvcHRbJ3BhZ2VfcGF0aCddID0gcGF0aDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRpdGxlKSB7XHJcbiAgICAgICAgICBvcHRbJ3BhZ2VfdGl0bGUnXSA9IHRpdGxlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobG9jYXRpb24pIHtcclxuICAgICAgICAgIG9wdFsncGFnZV9sb2NhdGlvbiddID0gbG9jYXRpb247XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChvcHRpb25zKSB7XHJcbiAgICAgICAgICBPYmplY3QuYXNzaWduKG9wdCwgb3B0aW9ucyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZ3RhZygnY29uZmlnJywgdGhpcy4kdHJhY2tpbmdJZC50cmFja2luZ0NvZGUsIG9wdCk7XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHRoaXMudGhyb3coZXJyb3IpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2VuZCBhbiBldmVudG8gdG8gcmVwb3J0IGEgQXBwIFBhZ2UgVmlldy4gSXQgaXMgdGhlIHNhbWUgYXNcclxuICAgKlxyXG4gICAqIGBgYGpzXHJcbiAgICogZ3RhZygnZXZlbnQnLCAnc2NyZWVuX3ZpZXcnLCB7XHJcbiAgICogICAnYXBwX25hbWUnOiAnbXlBcHBOYW1lJyxcclxuICAgKiAgICdzY3JlZW5fbmFtZScgOiAnSG9tZSdcclxuICAgKiB9KTtcclxuICAgKlxyXG4gICAqIGBgYFxyXG4gICAqXHJcbiAgICogQHBhcmFtIHNjcmVlbiAnc2NyZWVuX25hbWUnXHJcbiAgICogQHBhcmFtIG5hbWUgJ2FwcF9uYW1lJ1xyXG4gICAqIEBwYXJhbSBhcHBJZCAnYXBwX2lkJ1xyXG4gICAqIEBwYXJhbSBhcHBWZXJzaW9uICdhcHBfdmVyc2lvbidcclxuICAgKiBAcGFyYW0gaW5zdGFsbGVySWQgJ2FwcF9pbnN0YWxsZXJfaWQnXHJcbiAgICovXHJcbiAgYXBwVmlldyhzY3JlZW46IHN0cmluZywgYXBwTmFtZTogc3RyaW5nLCBhcHBJZD86IHN0cmluZywgYXBwVmVyc2lvbj86IHN0cmluZywgaW5zdGFsbGVySWQ/OiBzdHJpbmcpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGlmICh3aW5kb3dbJ2d0YWcnXSkge1xyXG4gICAgICAgIGNvbnN0IG9wdCA9IHt9O1xyXG4gICAgICAgIGlmIChzY3JlZW4pIHtcclxuICAgICAgICAgIG9wdFsnc2NyZWVuX25hbWUnXSA9IHNjcmVlbjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGFwcE5hbWUpIHtcclxuICAgICAgICAgIG9wdFsnYXBwX25hbWUnXSA9IGFwcE5hbWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChhcHBJZCkge1xyXG4gICAgICAgICAgb3B0WydhcHBfaWQnXSA9IGFwcElkO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoYXBwVmVyc2lvbikge1xyXG4gICAgICAgICAgb3B0WydhcHBfdmVyc2lvbiddID0gYXBwVmVyc2lvbjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGluc3RhbGxlcklkKSB7XHJcbiAgICAgICAgICBvcHRbJ2FwcF9pbnN0YWxsZXJfaWQnXSA9IGluc3RhbGxlcklkO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmd0YWcoJ2V2ZW50JywgJ3NjcmVlbl92aWV3Jywgb3B0KTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhpcy50aHJvdyhlcnJvcik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZW5kIGFuIGV2ZW50IHRvIEdBIHRvIHJlcG9ydCBhbiBhcHBsaWNhdGlvbiBlcnJvci4gSXQgaXMgdGhlIHNhbWUgYXNcclxuICAgKlxyXG4gICAqIGBgYGpzXHJcbiAgICogZ3RhZygnZXZlbnQnLCAnZXhjZXB0aW9uJywge1xyXG4gICAqICAgJ2Rlc2NyaXB0aW9uJzogJ2Vycm9yX2Rlc2NyaXB0aW9uJyxcclxuICAgKiAgICdmYXRhbCc6IGZhbHNlICAgLy8gc2V0IHRvIHRydWUgaWYgdGhlIGVycm9yIGlzIGZhdGFsXHJcbiAgICogfSk7XHJcbiAgICogYGBgXHJcbiAgICpcclxuICAgKiBAcGFyYW0gZGVzY3JpcHRpb24gJ2Vycm9yX2Rlc2NyaXB0aW9uJ1xyXG4gICAqIEBwYXJhbSBmYXRhbCBzZXQgdG8gdHJ1ZSBpZiB0aGUgZXJyb3IgaXMgZmF0YWxcclxuICAgKi9cclxuICBleGNlcHRpb24oZGVzY3JpcHRpb24/OiBzdHJpbmcsIGZhdGFsPzogYm9vbGVhbikge1xyXG4gICAgdHJ5IHtcclxuICAgICAgaWYgKHdpbmRvd1snZ3RhZyddKSB7XHJcbiAgICAgICAgY29uc3Qgb3B0ID0ge307XHJcbiAgICAgICAgaWYgKGRlc2NyaXB0aW9uKSB7XHJcbiAgICAgICAgICBvcHRbJ2Rlc2NyaXB0aW9uJ10gPSBkZXNjcmlwdGlvbjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGZhdGFsKSB7XHJcbiAgICAgICAgICBvcHRbJ2ZhdGFsJ10gPSBmYXRhbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5ndGFnKCdldmVudCcsICdleGNlcHRpb24nLCBvcHQpO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aGlzLnRocm93KGVycm9yKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuIl19