export function getWindow() { return window; }
export function acceptType(accept, type, name) {
    if (!accept) {
        return true;
    }
    var defs = accept.split(',');
    var regx;
    var acceptRegString;
    for (var x = defs.length - 1; x >= 0; --x) {
        //Escapes dots in mimetype 
        acceptRegString = defs[x];
        //trim
        acceptRegString = acceptRegString.replace(/(^\s+|\s+$)/g, '');
        //Escapes stars in mimetype 
        acceptRegString = acceptRegString.replace(/\*/g, '.*');
        //let acceptReg = '^((' + acceptRegString
        //acceptReg = acceptReg.replace(/,/g,')|(') + '))$'
        //try by mime
        regx = new RegExp(acceptRegString, 'gi');
        if (type.search(regx) >= 0) {
            return true;
        }
        //try by ext
        if (acceptRegString.substring(0, 1) == '.') {
            acceptRegString = '\\' + acceptRegString; //.substring(1, acceptRegString.length-1)//remove dot at front
            regx = new RegExp(acceptRegString + '$', 'i');
            if ((name || type).search(regx) >= 0) {
                return true;
            }
        }
    }
    return false;
}
export function arrayBufferToBase64(buffer) {
    var binary = '';
    var bytes = new Uint8Array(buffer);
    var len = bytes.byteLength;
    for (var i = 0; i < len; i++) {
        binary += String.fromCharCode(bytes[i]);
    }
    return window.btoa(binary);
}
export function dataUrltoBlob(dataurl, name, origSize) {
    var arr = dataurl.split(',');
    var mimeMatch = arr[0].match(/:(.*?);/);
    var mime = mimeMatch ? mimeMatch[1] : 'text/plain';
    var bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);
    while (n--) {
        u8arr[n] = bstr.charCodeAt(n);
    }
    var blob = new window.Blob([u8arr], { type: mime });
    blob["name"] = name;
    blob["$ngfOrigSize"] = origSize;
    return blob;
}
export function applyTransform(ctx, orientation, width, height) {
    switch (orientation) {
        case 2:
            return ctx.transform(-1, 0, 0, 1, width, 0);
        case 3:
            return ctx.transform(-1, 0, 0, -1, width, height);
        case 4:
            return ctx.transform(1, 0, 0, -1, 0, height);
        case 5:
            return ctx.transform(0, 1, 1, 0, 0, 0);
        case 6:
            return ctx.transform(0, 1, -1, 0, height, 0);
        case 7:
            return ctx.transform(0, -1, -1, 0, height, width);
        case 8:
            return ctx.transform(0, -1, 1, 0, 0, width);
    }
}
export function fixFileOrientationByMeta(file, result) {
    return dataUrl(file, true)
        .then(function (url) {
        var canvas = document.createElement('canvas');
        var img = document.createElement('img');
        return new Promise(function (res, rej) {
            img.onload = function () {
                try {
                    canvas.width = result.orientation > 4 ? img.height : img.width;
                    canvas.height = result.orientation > 4 ? img.width : img.height;
                    var ctx = canvas.getContext('2d');
                    applyTransform(ctx, result.orientation, img.width, img.height);
                    ctx.drawImage(img, 0, 0);
                    var dataUrl = canvas.toDataURL(file.type || 'image/WebP', 0.934);
                    var base = arrayBufferToBase64(result.fixedArrayBuffer);
                    dataUrl = restoreExif(base, dataUrl);
                    var blob = dataUrltoBlob(dataUrl, file.name);
                    res(blob);
                }
                catch (e) {
                    rej(e);
                }
            };
            img.onerror = rej;
            img.src = url;
        });
    });
}
export function applyExifRotation(file) {
    if (file.type.indexOf('image/jpeg') !== 0) {
        return Promise.resolve(file);
    }
    return readOrientation(file)
        .then(function (result) {
        if (result.orientation < 2 || result.orientation > 8) {
            return file;
        }
        return fixFileOrientationByMeta(file, result);
    })
        .then(function () { return file; });
}
export function readOrientation(file) {
    return new Promise(function (res, rej) {
        var reader = new FileReader();
        var slicedFile = file.slice ? file.slice(0, 64 * 1024) : file;
        reader.readAsArrayBuffer(slicedFile);
        reader.onerror = rej;
        reader.onload = function (e) {
            var result = { orientation: 1 };
            var view = new DataView(this.result);
            if (view.getUint16(0, false) !== 0xFFD8)
                return res(result);
            var length = view.byteLength, offset = 2;
            while (offset < length) {
                var marker = view.getUint16(offset, false);
                offset += 2;
                if (marker === 0xFFE1) {
                    if (view.getUint32(offset += 2, false) !== 0x45786966)
                        return res(result);
                    var little = view.getUint16(offset += 6, false) === 0x4949;
                    offset += view.getUint32(offset + 4, little);
                    var tags = view.getUint16(offset, little);
                    offset += 2;
                    for (var i = 0; i < tags; i++)
                        if (view.getUint16(offset + (i * 12), little) === 0x0112) {
                            var orientation = view.getUint16(offset + (i * 12) + 8, little);
                            if (orientation >= 2 && orientation <= 8) {
                                view.setUint16(offset + (i * 12) + 8, 1, little);
                                result.fixedArrayBuffer = e.target.result;
                            }
                            result.orientation = orientation;
                            return res(result);
                        }
                }
                else if ((marker & 0xFF00) !== 0xFF00)
                    break;
                else
                    offset += view.getUint16(offset, false);
            }
            return res(result);
        };
    });
}
/** converts file-input file into base64 dataUri */
export function dataUrl(file, disallowObjectUrl) {
    if (!file)
        return Promise.resolve(file);
    if ((disallowObjectUrl && file.$ngfDataUrl != null) || (!disallowObjectUrl && file.$ngfBlobUrl != null)) {
        return Promise.resolve(disallowObjectUrl ? file.$ngfDataUrl : file.$ngfBlobUrl);
    }
    var p = disallowObjectUrl ? file.$$ngfDataUrlPromise : file.$$ngfBlobUrlPromise;
    if (p)
        return p;
    var win = getWindow();
    var deferred;
    if (win.FileReader && file &&
        (!win.FileAPI || navigator.userAgent.indexOf('MSIE 8') === -1 || file.size < 20000) &&
        (!win.FileAPI || navigator.userAgent.indexOf('MSIE 9') === -1 || file.size < 4000000)) {
        //prefer URL.createObjectURL for handling refrences to files of all sizes
        //since it doesnÂ´t build a large string in memory
        var URL = win.URL || win.webkitURL;
        if (FileReader) {
            deferred = new Promise(function (res, rej) {
                var fileReader = new FileReader();
                fileReader.onload = function (event) {
                    file.$ngfDataUrl = event.target.result;
                    delete file.$ngfDataUrl;
                    res(event.target.result);
                };
                fileReader.onerror = function (e) {
                    file.$ngfDataUrl = '';
                    rej(e);
                };
                fileReader.readAsDataURL(file);
            });
        }
        else {
            var url;
            try {
                url = URL.createObjectURL(file);
            }
            catch (e) {
                return Promise.reject(e);
            }
            deferred = Promise.resolve(url);
            file.$ngfBlobUrl = url;
        }
    }
    else {
        file[disallowObjectUrl ? '$ngfDataUrl' : '$ngfBlobUrl'] = '';
        return Promise.reject(new Error('Browser does not support window.FileReader, window.FileReader, or window.FileAPI')); //deferred.reject();
    }
    if (disallowObjectUrl) {
        p = file.$$ngfDataUrlPromise = deferred;
    }
    else {
        p = file.$$ngfBlobUrlPromise = deferred;
    }
    p = p.then(function (x) {
        delete file[disallowObjectUrl ? '$$ngfDataUrlPromise' : '$$ngfBlobUrlPromise'];
        return x;
    });
    return p;
}
export function restoreExif(orig, resized) {
    var ExifRestorer = {
        KEY_STR: 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='
    };
    ExifRestorer.encode64 = function (input) {
        var output = '', chr1, chr2, chr3 = '', enc1, enc2, enc3, enc4 = '', i = 0;
        do {
            chr1 = input[i++];
            chr2 = input[i++];
            chr3 = input[i++];
            enc1 = chr1 >> 2;
            enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);
            enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);
            enc4 = chr3 & 63;
            if (isNaN(chr2)) {
                enc3 = enc4 = 64;
            }
            else if (isNaN(chr3)) {
                enc4 = 64;
            }
            output = output +
                this.KEY_STR.charAt(enc1) +
                this.KEY_STR.charAt(enc2) +
                this.KEY_STR.charAt(enc3) +
                this.KEY_STR.charAt(enc4);
            chr1 = chr2 = chr3 = '';
            enc1 = enc2 = enc3 = enc4 = '';
        } while (i < input.length);
        return output;
    };
    ExifRestorer.restore = function (origFileBase64, resizedFileBase64) {
        if (origFileBase64.match('data:image/jpeg;base64,')) {
            origFileBase64 = origFileBase64.replace('data:image/jpeg;base64,', '');
        }
        var rawImage = this.decode64(origFileBase64);
        var segments = this.slice2Segments(rawImage);
        var image = this.exifManipulation(resizedFileBase64, segments);
        return 'data:image/jpeg;base64,' + this.encode64(image);
    };
    ExifRestorer.exifManipulation = function (resizedFileBase64, segments) {
        var exifArray = this.getExifArray(segments), newImageArray = this.insertExif(resizedFileBase64, exifArray);
        return new Uint8Array(newImageArray);
    };
    ExifRestorer.getExifArray = function (segments) {
        var seg;
        for (var x = 0; x < segments.length; x++) {
            seg = segments[x];
            if (seg[0] === 255 && seg[1] === 225) //(ff e1)
             {
                return seg;
            }
        }
        return [];
    };
    ExifRestorer.insertExif = function (resizedFileBase64, exifArray) {
        var imageData = resizedFileBase64.replace('data:image/jpeg;base64,', ''), buf = this.decode64(imageData), separatePoint = buf.indexOf(255, 3), mae = buf.slice(0, separatePoint), ato = buf.slice(separatePoint), array = mae;
        array = array.concat(exifArray);
        array = array.concat(ato);
        return array;
    };
    ExifRestorer.slice2Segments = function (rawImageArray) {
        var head = 0, segments = [];
        while (1) {
            if (rawImageArray[head] === 255 && rawImageArray[head + 1] === 218) {
                break;
            }
            if (rawImageArray[head] === 255 && rawImageArray[head + 1] === 216) {
                head += 2;
            }
            else {
                var length = rawImageArray[head + 2] * 256 + rawImageArray[head + 3];
                var endPoint = head + length + 2;
                var seg = rawImageArray.slice(head, endPoint);
                segments.push(seg);
                head = endPoint;
            }
            if (head > rawImageArray.length) {
                break;
            }
        }
        return segments;
    };
    ExifRestorer.decode64 = function (input) {
        var chr1, chr2, chr3 = '', enc1, enc2, enc3, enc4 = '', i = 0, buf = [];
        // remove all characters that are not A-Z, a-z, 0-9, +, /, or =
        var base64test = /[^A-Za-z0-9\+\/\=]/g;
        if (base64test.exec(input)) {
            console.log('There were invalid base64 characters in the input text.');
        }
        input = input.replace(/[^A-Za-z0-9\+\/\=]/g, '');
        do {
            enc1 = this.KEY_STR.indexOf(input.charAt(i++));
            enc2 = this.KEY_STR.indexOf(input.charAt(i++));
            enc3 = this.KEY_STR.indexOf(input.charAt(i++));
            enc4 = this.KEY_STR.indexOf(input.charAt(i++));
            chr1 = (enc1 << 2) | (enc2 >> 4);
            chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);
            chr3 = ((enc3 & 3) << 6) | enc4;
            buf.push(chr1);
            if (enc3 !== 64) {
                buf.push(chr2);
            }
            if (enc4 !== 64) {
                buf.push(chr3);
            }
            chr1 = chr2 = chr3 = '';
            enc1 = enc2 = enc3 = enc4 = '';
        } while (i < input.length);
        return buf;
    };
    return ExifRestorer.restore(orig, resized); //<= EXIF
}
;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZVRvb2xzLmpzIiwic291cmNlUm9vdCI6Im5nOi8vYW5ndWxhci1maWxlLyIsInNvdXJjZXMiOlsiZmlsZS11cGxvYWQvZmlsZVRvb2xzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE1BQU0sVUFBVSxTQUFTLEtBQU8sT0FBTyxNQUFNLENBQUEsQ0FBQSxDQUFDO0FBRTlDLE1BQU0sVUFBVSxVQUFVLENBQUMsTUFBYSxFQUFFLElBQVcsRUFBRSxJQUFZO0lBQ2pFLElBQUksQ0FBQyxNQUFNLEVBQUU7UUFDWCxPQUFPLElBQUksQ0FBQTtLQUNaO0lBRUQsSUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQTtJQUM5QixJQUFJLElBQVcsQ0FBQTtJQUNmLElBQUksZUFBc0IsQ0FBQTtJQUUxQixLQUFJLElBQUksQ0FBQyxHQUFDLElBQUksQ0FBQyxNQUFNLEdBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLEVBQUM7UUFDbkMsMkJBQTJCO1FBQzNCLGVBQWUsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFDekIsTUFBTTtRQUNOLGVBQWUsR0FBRyxlQUFlLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBQyxFQUFFLENBQUMsQ0FBQTtRQUM1RCw0QkFBNEI7UUFDNUIsZUFBZSxHQUFHLGVBQWUsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFDLElBQUksQ0FBQyxDQUFBO1FBQ3JELHlDQUF5QztRQUN6QyxtREFBbUQ7UUFFbkQsYUFBYTtRQUNiLElBQUksR0FBRyxJQUFJLE1BQU0sQ0FBQyxlQUFlLEVBQUUsSUFBSSxDQUFDLENBQUE7UUFDeEMsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFFLENBQUMsRUFBRTtZQUN4QixPQUFPLElBQUksQ0FBQTtTQUNaO1FBRUQsWUFBWTtRQUNaLElBQUksZUFBZSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxD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QUssRUFBRSxFQUFFO2dCQUNmLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7YUFDaEI7WUFFRCxJQUFJLEdBQUcsSUFBSSxHQUFHLElBQUksR0FBRyxFQUFFLENBQUM7WUFDeEIsSUFBSSxHQUFHLElBQUksR0FBRyxJQUFJLEdBQUcsSUFBSSxHQUFHLEVBQUUsQ0FBQztTQUVoQyxRQUFRLENBQUMsR0FBRyxLQUFLLENBQUMsTUFBTSxFQUFFO1FBRTNCLE9BQU8sR0FBRyxDQUFDO0lBQ2IsQ0FBQyxDQUFDO0lBRUYsT0FBTyxZQUFZLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFFLFNBQVM7QUFDeEQsQ0FBQztBQUFBLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZnVuY3Rpb24gZ2V0V2luZG93KCk6YW55e3JldHVybiB3aW5kb3d9XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gYWNjZXB0VHlwZShhY2NlcHQ6c3RyaW5nLCB0eXBlOnN0cmluZywgbmFtZT86c3RyaW5nKTpib29sZWFuIHsgICBcclxuICBpZiggIWFjY2VwdCApe1xyXG4gICAgcmV0dXJuIHRydWVcclxuICB9XHJcblxyXG4gIGNvbnN0IGRlZnMgPSBhY2NlcHQuc3BsaXQoJywnKVxyXG4gIGxldCByZWd4OlJlZ0V4cFxyXG4gIGxldCBhY2NlcHRSZWdTdHJpbmc6c3RyaW5nXHJcblxyXG4gIGZvcihsZXQgeD1kZWZzLmxlbmd0aC0xOyB4ID49IDA7IC0teCl7XHJcbiAgICAvL0VzY2FwZXMgZG90cyBpbiBtaW1ldHlwZSBcclxuICAgIGFjY2VwdFJlZ1N0cmluZyA9IGRlZnNbeF1cclxuICAgIC8vdHJpbVxyXG4gICAgYWNjZXB0UmVnU3RyaW5nID0gYWNjZXB0UmVnU3RyaW5nLnJlcGxhY2UoLyheXFxzK3xcXHMrJCkvZywnJylcclxuICAgIC8vRXNjYXBlcyBzdGFycyBpbiBtaW1ldHlwZSBcclxuICAgIGFjY2VwdFJlZ1N0cmluZyA9IGFjY2VwdFJlZ1N0cmluZy5yZXBsYWNlKC9cXCovZywnLionKVxyXG4gICAgLy9sZXQgYWNjZXB0UmVnID0gJ14oKCcgKyBhY2NlcHRSZWdTdHJpbmdcclxuICAgIC8vYWNjZXB0UmVnID0gYWNjZXB0UmVnLnJlcGxhY2UoLywvZywnKXwoJykgKyAnKSkkJ1xyXG4gICAgXHJcbiAgICAvL3RyeSBieSBtaW1lXHJcbiAgICByZWd4ID0gbmV3IFJlZ0V4cChhY2NlcHRSZWdTdHJpbmcsICdnaScpXHJcbiAgICBpZiggdHlwZS5zZWFyY2gocmVneCk+PTAgKXtcclxuICAgICAgcmV0dXJuIHRydWVcclxuICAgIH1cclxuXHJcbiAgICAvL3RyeSBieSBleHRcclxuICAgIGlmKCBhY2NlcHRSZWdTdHJpbmcuc3Vic3RyaW5nKDAsIDEpPT0nLicgKXsgICAgICBcclxuICAgICAgYWNjZXB0UmVnU3RyaW5nID0gJ1xcXFwnKyBhY2NlcHRSZWdTdHJpbmcvLy5zdWJzdHJpbmcoMSwgYWNjZXB0UmVnU3RyaW5nLmxlbmd0aC0xKS8vcmVtb3ZlIGRvdCBhdCBmcm9udFxyXG4gICAgICByZWd4ID0gbmV3IFJlZ0V4cChhY2NlcHRSZWdTdHJpbmcrJyQnLCAnaScpXHJcbiAgICAgIGlmKCAobmFtZXx8dHlwZSkuc2VhcmNoKHJlZ3gpPj0wICl7XHJcbiAgICAgICAgcmV0dXJuIHRydWVcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICByZXR1cm4gZmFsc2VcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBJbnZhbGlkRmlsZUl0ZW17XHJcbiAgZmlsZTpGaWxlXHJcbiAgdHlwZTpzdHJpbmdcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGFycmF5QnVmZmVyVG9CYXNlNjQoYnVmZmVyOmFueSkge1xyXG4gIHZhciBiaW5hcnkgPSAnJztcclxuICB2YXIgYnl0ZXMgPSBuZXcgVWludDhBcnJheShidWZmZXIpO1xyXG4gIHZhciBsZW4gPSBieXRlcy5ieXRlTGVuZ3RoO1xyXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcclxuICAgIGJpbmFyeSArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGJ5dGVzW2ldKTtcclxuICB9XHJcbiAgcmV0dXJuIHdpbmRvdy5idG9hKGJpbmFyeSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBkYXRhVXJsdG9CbG9iKFxyXG4gIGRhdGF1cmw6c3RyaW5nLFxyXG4gIG5hbWU6c3RyaW5nLFxyXG4gIG9yaWdTaXplPzphbnlcclxuKTpCbG9ie1xyXG4gIHZhciBhcnIgPSBkYXRhdXJsLnNwbGl0KCcsJyk7XHJcbiAgdmFyIG1pbWVNYXRjaCA9IGFyclswXS5tYXRjaCgvOiguKj8pOy8pXHJcbiAgdmFyIG1pbWU6c3RyaW5nID0gbWltZU1hdGNoID8gbWltZU1hdGNoWzFdIDogJ3RleHQvcGxhaW4nXHJcbiAgdmFyIGJzdHIgPSBhdG9iKGFyclsxXSksIG4gPSBic3RyLmxlbmd0aCwgdThhcnIgPSBuZXcgVWludDhBcnJheShuKTtcclxuICB3aGlsZSAobi0tKSB7XHJcbiAgICB1OGFycltuXSA9IGJzdHIuY2hhckNvZGVBdChuKTtcclxuICB9XHJcbiAgdmFyIGJsb2IgPSBuZXcgd2luZG93LkJsb2IoW3U4YXJyXSwge3R5cGU6IG1pbWV9KTtcclxuICBibG9iW1wibmFtZVwiXSA9IG5hbWU7XHJcbiAgYmxvYltcIiRuZ2ZPcmlnU2l6ZVwiXSA9IG9yaWdTaXplO1xyXG4gIHJldHVybiBibG9iO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIG9yaWVudGF0aW9uTWV0YXtcclxuICBvcmllbnRhdGlvbjogbnVtYmVyXHJcbiAgZml4ZWRBcnJheUJ1ZmZlcj86YW55W11cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGFwcGx5VHJhbnNmb3JtKFxyXG4gIGN0eDpDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQsXHJcbiAgb3JpZW50YXRpb246bnVtYmVyLFxyXG4gIHdpZHRoOm51bWJlcixcclxuICBoZWlnaHQ6bnVtYmVyXHJcbikge1xyXG4gIHN3aXRjaCAob3JpZW50YXRpb24pIHtcclxuICAgIGNhc2UgMjpcclxuICAgICAgcmV0dXJuIGN0eC50cmFuc2Zvcm0oLTEsIDAsIDAsIDEsIHdpZHRoLCAwKTtcclxuICAgIGNhc2UgMzpcclxuICAgICAgcmV0dXJuIGN0eC50cmFuc2Zvcm0oLTEsIDAsIDAsIC0xLCB3aWR0aCwgaGVpZ2h0KTtcclxuICAgIGNhc2UgNDpcclxuICAgICAgcmV0dXJuIGN0eC50cmFuc2Zvcm0oMSwgMCwgMCwgLTEsIDAsIGhlaWdodCk7XHJcbiAgICBjYXNlIDU6XHJcbiAgICAgIHJldHVybiBjdHgudHJhbnNmb3JtKDAsIDEsIDEsIDAsIDAsIDApO1xyXG4gICAgY2FzZSA2OlxyXG4gICAgICByZXR1cm4gY3R4LnRyYW5zZm9ybSgwLCAxLCAtMSwgMCwgaGVpZ2h0LCAwKTtcclxuICAgIGNhc2UgNzpcclxuICAgICAgcmV0dXJuIGN0eC50cmFuc2Zvcm0oMCwgLTEsIC0xLCAwLCBoZWlnaHQsIHdpZHRoKTtcclxuICAgIGNhc2UgODpcclxuICAgICAgcmV0dXJuIGN0eC50cmFuc2Zvcm0oMCwgLTEsIDEsIDAsIDAsIHdpZHRoKTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBmaXhGaWxlT3JpZW50YXRpb25CeU1ldGEoXHJcbiAgZmlsZTpGaWxlLCByZXN1bHQ6b3JpZW50YXRpb25NZXRhXHJcbik6UHJvbWlzZTxCbG9iPntcclxuICByZXR1cm4gZGF0YVVybChmaWxlLCB0cnVlKVxyXG4gIC50aGVuKHVybD0+e1xyXG4gICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xyXG4gICAgdmFyIGltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xyXG5cclxuICAgIHJldHVybiA8UHJvbWlzZTxCbG9iPj5uZXcgUHJvbWlzZShmdW5jdGlvbihyZXMscmVqKXtcclxuICAgICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgY2FudmFzLndpZHRoID0gcmVzdWx0Lm9yaWVudGF0aW9uID4gNCA/IGltZy5oZWlnaHQgOiBpbWcud2lkdGhcclxuICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSByZXN1bHQub3JpZW50YXRpb24gPiA0ID8gaW1nLndpZHRoIDogaW1nLmhlaWdodFxyXG4gICAgICAgICAgdmFyIGN0eCA9IDxDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQ+Y2FudmFzLmdldENvbnRleHQoJzJkJylcclxuICAgICAgICAgIGFwcGx5VHJhbnNmb3JtKGN0eCwgcmVzdWx0Lm9yaWVudGF0aW9uLCBpbWcud2lkdGgsIGltZy5oZWlnaHQpXHJcbiAgICAgICAgICBjdHguZHJhd0ltYWdlKGltZywgMCwgMCk7XHJcbiAgICAgICAgICB2YXIgZGF0YVVybCA9IGNhbnZhcy50b0RhdGFVUkwoZmlsZS50eXBlIHx8ICdpbWFnZS9XZWJQJywgMC45MzQpXHJcbiAgICAgICAgICBjb25zdCBiYXNlID0gYXJyYXlCdWZmZXJUb0Jhc2U2NChyZXN1bHQuZml4ZWRBcnJheUJ1ZmZlcilcclxuICAgICAgICAgIGRhdGFVcmwgPSByZXN0b3JlRXhpZihiYXNlLCBkYXRhVXJsKVxyXG4gICAgICAgICAgdmFyIGJsb2IgPSBkYXRhVXJsdG9CbG9iKGRhdGFVcmwsIGZpbGUubmFtZSlcclxuICAgICAgICAgIHJlcyhibG9iKVxyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgIHJlaihlKVxyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuICAgICAgaW1nLm9uZXJyb3IgPSByZWo7XHJcbiAgICAgIGltZy5zcmMgPSB1cmw7ICAgIFxyXG4gICAgfSlcclxuICB9KVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gYXBwbHlFeGlmUm90YXRpb24oXHJcbiAgZmlsZTpGaWxlXHJcbik6UHJvbWlzZTxGaWxlPntcclxuICBpZiAoZmlsZS50eXBlLmluZGV4T2YoJ2ltYWdlL2pwZWcnKSAhPT0gMCkge1xyXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShmaWxlKTtcclxuICB9XHJcblxyXG4gIHJldHVybiByZWFkT3JpZW50YXRpb24oZmlsZSlcclxuICAudGhlbigocmVzdWx0Om9yaWVudGF0aW9uTWV0YSk9PntcclxuICAgIGlmIChyZXN1bHQub3JpZW50YXRpb24gPCAyIHx8IHJlc3VsdC5vcmllbnRhdGlvbiA+IDgpIHtcclxuICAgICAgcmV0dXJuIGZpbGVcclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIGZpeEZpbGVPcmllbnRhdGlvbkJ5TWV0YShmaWxlLHJlc3VsdClcclxuICB9KVxyXG4gIC50aGVuKCgpPT5maWxlKVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcmVhZE9yaWVudGF0aW9uKFxyXG4gIGZpbGU6RmlsZVxyXG4pOlByb21pc2U8b3JpZW50YXRpb25NZXRhPntcclxuICByZXR1cm4gbmV3IFByb21pc2UoKHJlcyxyZWopPT57XHJcbiAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuICAgIHZhciBzbGljZWRGaWxlID0gZmlsZS5zbGljZSA/IGZpbGUuc2xpY2UoMCwgNjQgKiAxMDI0KSA6IGZpbGU7XHJcbiAgICByZWFkZXIucmVhZEFzQXJyYXlCdWZmZXIoc2xpY2VkRmlsZSk7XHJcbiAgICByZWFkZXIub25lcnJvciA9IHJlalxyXG4gICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlOmFueSkge1xyXG4gICAgICB2YXIgcmVzdWx0Om9yaWVudGF0aW9uTWV0YSA9IHtvcmllbnRhdGlvbjogMX07XHJcbiAgICAgIHZhciB2aWV3ID0gbmV3IERhdGFWaWV3KCA8QXJyYXlCdWZmZXI+dGhpcy5yZXN1bHQgKTtcclxuICAgICAgaWYgKHZpZXcuZ2V0VWludDE2KDAsIGZhbHNlKSAhPT0gMHhGRkQ4KSByZXR1cm4gcmVzKHJlc3VsdCk7XHJcblxyXG4gICAgICB2YXIgbGVuZ3RoID0gdmlldy5ieXRlTGVuZ3RoLFxyXG4gICAgICAgIG9mZnNldCA9IDI7XHJcbiAgICAgIHdoaWxlIChvZmZzZXQgPCBsZW5ndGgpIHtcclxuICAgICAgICB2YXIgbWFya2VyID0gdmlldy5nZXRVaW50MTYob2Zmc2V0LCBmYWxzZSk7XHJcbiAgICAgICAgb2Zmc2V0ICs9IDI7XHJcbiAgICAgICAgaWYgKG1hcmtlciA9PT0gMHhGRkUxKSB7XHJcbiAgICAgICAgICBpZiAodmlldy5nZXRVaW50MzIob2Zmc2V0ICs9IDIsIGZhbHNlKSAhPT0gMHg0NTc4Njk2NikgcmV0dXJuIHJlcyhyZXN1bHQpO1xyXG5cclxuICAgICAgICAgIHZhciBsaXR0bGUgPSB2aWV3LmdldFVpbnQxNihvZmZzZXQgKz0gNiwgZmFsc2UpID09PSAweDQ5NDk7XHJcbiAgICAgICAgICBvZmZzZXQgKz0gdmlldy5nZXRVaW50MzIob2Zmc2V0ICsgNCwgbGl0dGxlKTtcclxuICAgICAgICAgIHZhciB0YWdzID0gdmlldy5nZXRVaW50MTYob2Zmc2V0LCBsaXR0bGUpO1xyXG4gICAgICAgICAgb2Zmc2V0ICs9IDI7XHJcbiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRhZ3M7IGkrKylcclxuICAgICAgICAgICAgaWYgKHZpZXcuZ2V0VWludDE2KG9mZnNldCArIChpICogMTIpLCBsaXR0bGUpID09PSAweDAxMTIpIHtcclxuICAgICAgICAgICAgICB2YXIgb3JpZW50YXRpb24gPSB2aWV3LmdldFVpbnQxNihvZmZzZXQgKyAoaSAqIDEyKSArIDgsIGxpdHRsZSk7XHJcbiAgICAgICAgICAgICAgaWYgKG9yaWVudGF0aW9uID49IDIgJiYgb3JpZW50YXRpb24gPD0gOCkge1xyXG4gICAgICAgICAgICAgICAgdmlldy5zZXRVaW50MTYob2Zmc2V0ICsgKGkgKiAxMikgKyA4LCAxLCBsaXR0bGUpO1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0LmZpeGVkQXJyYXlCdWZmZXIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIHJlc3VsdC5vcmllbnRhdGlvbiA9IG9yaWVudGF0aW9uO1xyXG4gICAgICAgICAgICAgIHJldHVybiByZXMocmVzdWx0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSBpZiAoKG1hcmtlciAmIDB4RkYwMCkgIT09IDB4RkYwMCkgYnJlYWs7XHJcbiAgICAgICAgZWxzZSBvZmZzZXQgKz0gdmlldy5nZXRVaW50MTYob2Zmc2V0LCBmYWxzZSk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHJlcyhyZXN1bHQpO1xyXG4gICAgfTtcclxuICB9KVxyXG59XHJcblxyXG4vKiogY29udmVydHMgZmlsZS1pbnB1dCBmaWxlIGludG8gYmFzZTY0IGRhdGFVcmkgKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGRhdGFVcmwoXHJcbiAgZmlsZTphbnksXHJcbiAgZGlzYWxsb3dPYmplY3RVcmw/OmFueVxyXG4pOlByb21pc2U8c3RyaW5nPntcclxuICBpZiAoIWZpbGUpIHJldHVybiBQcm9taXNlLnJlc29sdmUoZmlsZSlcclxuICBcclxuICBpZiAoKGRpc2FsbG93T2JqZWN0VXJsICYmIGZpbGUuJG5nZkRhdGFVcmwgIT0gbnVsbCkgfHwgKCFkaXNhbGxvd09iamVjdFVybCAmJiBmaWxlLiRuZ2ZCbG9iVXJsICE9IG51bGwpKSB7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCBkaXNhbGxvd09iamVjdFVybCA/IGZpbGUuJG5nZkRhdGFVcmwgOiBmaWxlLiRuZ2ZCbG9iVXJsIClcclxuICB9XHJcblxyXG4gIHZhciBwID0gZGlzYWxsb3dPYmplY3RVcmwgPyBmaWxlLiQkbmdmRGF0YVVybFByb21pc2UgOiBmaWxlLiQkbmdmQmxvYlVybFByb21pc2U7XHJcbiAgaWYgKHApIHJldHVybiBwO1xyXG5cclxuICBjb25zdCB3aW4gPSBnZXRXaW5kb3coKVxyXG4gIGxldCBkZWZlcnJlZDpQcm9taXNlPHN0cmluZz5cclxuICBpZiAod2luLkZpbGVSZWFkZXIgJiYgZmlsZSAmJlxyXG4gICAgKCF3aW4uRmlsZUFQSSB8fCBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ01TSUUgOCcpID09PSAtMSB8fCBmaWxlLnNpemUgPCAyMDAwMCkgJiZcclxuICAgICghd2luLkZpbGVBUEkgfHwgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdNU0lFIDknKSA9PT0gLTEgfHwgZmlsZS5zaXplIDwgNDAwMDAwMCkpIHtcclxuICAgIC8vcHJlZmVyIFVSTC5jcmVhdGVPYmplY3RVUkwgZm9yIGhhbmRsaW5nIHJlZnJlbmNlcyB0byBmaWxlcyBvZiBhbGwgc2l6ZXNcclxuICAgIC8vc2luY2UgaXQgZG9lc27CtHQgYnVpbGQgYSBsYXJnZSBzdHJpbmcgaW4gbWVtb3J5XHJcbiAgICB2YXIgVVJMID0gd2luLlVSTCB8fCB3aW4ud2Via2l0VVJMO1xyXG4gICAgaWYgKEZpbGVSZWFkZXIpIHtcclxuICAgICAgZGVmZXJyZWQgPSBuZXcgUHJvbWlzZSgocmVzLHJlaik9PntcclxuICAgICAgICB2YXIgZmlsZVJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XHJcbiAgICAgICAgZmlsZVJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZXZlbnQ6YW55KSB7XHJcbiAgICAgICAgICBmaWxlLiRuZ2ZEYXRhVXJsID0gZXZlbnQudGFyZ2V0LnJlc3VsdDtcclxuICAgICAgICAgIGRlbGV0ZSBmaWxlLiRuZ2ZEYXRhVXJsO1xyXG4gICAgICAgICAgcmVzKCBldmVudC50YXJnZXQucmVzdWx0IClcclxuICAgICAgICB9O1xyXG4gICAgICAgIGZpbGVSZWFkZXIub25lcnJvciA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICBmaWxlLiRuZ2ZEYXRhVXJsID0gJyc7XHJcbiAgICAgICAgICByZWooZSlcclxuICAgICAgICB9O1xyXG4gICAgICAgIGZpbGVSZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTtcclxuICAgICAgfSlcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHZhciB1cmw6YW55O1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoZmlsZSk7XHJcbiAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZSk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGRlZmVycmVkID0gUHJvbWlzZS5yZXNvbHZlKCB1cmwgKVxyXG4gICAgICBmaWxlLiRuZ2ZCbG9iVXJsID0gdXJsO1xyXG4gICAgfVxyXG4gIH0gZWxzZSB7XHJcbiAgICBmaWxlW2Rpc2FsbG93T2JqZWN0VXJsID8gJyRuZ2ZEYXRhVXJsJyA6ICckbmdmQmxvYlVybCddID0gJyc7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoIG5ldyBFcnJvcignQnJvd3NlciBkb2VzIG5vdCBzdXBwb3J0IHdpbmRvdy5GaWxlUmVhZGVyLCB3aW5kb3cuRmlsZVJlYWRlciwgb3Igd2luZG93LkZpbGVBUEknKSApLy9kZWZlcnJlZC5yZWplY3QoKTtcclxuICB9XHJcblxyXG4gIGlmIChkaXNhbGxvd09iamVjdFVybCkge1xyXG4gICAgcCA9IGZpbGUuJCRuZ2ZEYXRhVXJsUHJvbWlzZSA9IGRlZmVycmVkO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBwID0gZmlsZS4kJG5nZkJsb2JVcmxQcm9taXNlID0gZGVmZXJyZWQ7XHJcbiAgfVxyXG5cclxuICBwID0gcC50aGVuKCh4OmFueSk9PntcclxuICAgIGRlbGV0ZSBmaWxlW2Rpc2FsbG93T2JqZWN0VXJsID8gJyQkbmdmRGF0YVVybFByb21pc2UnIDogJyQkbmdmQmxvYlVybFByb21pc2UnXTtcclxuICAgIHJldHVybiB4XHJcbiAgfSlcclxuXHJcbiAgcmV0dXJuIHA7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiByZXN0b3JlRXhpZihvcmlnOmFueSwgcmVzaXplZDphbnkpIHtcclxuICB2YXIgRXhpZlJlc3RvcmVyOmFueSA9IHtcclxuICAgIEtFWV9TVFI6J0FCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky89J1xyXG4gIH1cclxuXHJcbiAgRXhpZlJlc3RvcmVyLmVuY29kZTY0ID0gZnVuY3Rpb24gKGlucHV0OmFueSkge1xyXG4gICAgdmFyIG91dHB1dCA9ICcnLFxyXG4gICAgICBjaHIxLCBjaHIyLCBjaHIzOmFueSA9ICcnLFxyXG4gICAgICBlbmMxLCBlbmMyLCBlbmMzLCBlbmM0OmFueSA9ICcnLFxyXG4gICAgICBpID0gMDtcclxuXHJcbiAgICBkbyB7XHJcbiAgICAgIGNocjEgPSBpbnB1dFtpKytdO1xyXG4gICAgICBjaHIyID0gaW5wdXRbaSsrXTtcclxuICAgICAgY2hyMyA9IGlucHV0W2krK107XHJcblxyXG4gICAgICBlbmMxID0gY2hyMSA+PiAyO1xyXG4gICAgICBlbmMyID0gKChjaHIxICYgMykgPDwgNCkgfCAoY2hyMiA+PiA0KTtcclxuICAgICAgZW5jMyA9ICgoY2hyMiAmIDE1KSA8PCAyKSB8IChjaHIzID4+IDYpO1xyXG4gICAgICBlbmM0ID0gY2hyMyAmIDYzO1xyXG5cclxuICAgICAgaWYgKGlzTmFOKGNocjIpKSB7XHJcbiAgICAgICAgZW5jMyA9IGVuYzQgPSA2NDtcclxuICAgICAgfSBlbHNlIGlmIChpc05hTihjaHIzKSkge1xyXG4gICAgICAgIGVuYzQgPSA2NDtcclxuICAgICAgfVxyXG5cclxuICAgICAgb3V0cHV0ID0gb3V0cHV0ICtcclxuICAgICAgICB0aGlzLktFWV9TVFIuY2hhckF0KGVuYzEpICtcclxuICAgICAgICB0aGlzLktFWV9TVFIuY2hhckF0KGVuYzIpICtcclxuICAgICAgICB0aGlzLktFWV9TVFIuY2hhckF0KGVuYzMpICtcclxuICAgICAgICB0aGlzLktFWV9TVFIuY2hhckF0KGVuYzQpO1xyXG4gICAgICBjaHIxID0gY2hyMiA9IGNocjMgPSAnJztcclxuICAgICAgZW5jMSA9IGVuYzIgPSBlbmMzID0gZW5jNCA9ICcnO1xyXG4gICAgfSB3aGlsZSAoaSA8IGlucHV0Lmxlbmd0aCk7XHJcblxyXG4gICAgcmV0dXJuIG91dHB1dDtcclxuICB9O1xyXG5cclxuICBFeGlmUmVzdG9yZXIucmVzdG9yZSA9IGZ1bmN0aW9uIChvcmlnRmlsZUJhc2U2NDphbnksIHJlc2l6ZWRGaWxlQmFzZTY0OmFueSkge1xyXG4gICAgaWYgKG9yaWdGaWxlQmFzZTY0Lm1hdGNoKCdkYXRhOmltYWdlL2pwZWc7YmFzZTY0LCcpKSB7XHJcbiAgICAgIG9yaWdGaWxlQmFzZTY0ID0gb3JpZ0ZpbGVCYXNlNjQucmVwbGFjZSgnZGF0YTppbWFnZS9qcGVnO2Jhc2U2NCwnLCAnJyk7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIHJhd0ltYWdlOm51bWJlcltdID0gdGhpcy5kZWNvZGU2NChvcmlnRmlsZUJhc2U2NCk7XHJcbiAgICB2YXIgc2VnbWVudHMgPSB0aGlzLnNsaWNlMlNlZ21lbnRzKHJhd0ltYWdlKTtcclxuXHJcbiAgICB2YXIgaW1hZ2UgPSB0aGlzLmV4aWZNYW5pcHVsYXRpb24ocmVzaXplZEZpbGVCYXNlNjQsIHNlZ21lbnRzKTtcclxuXHJcbiAgICByZXR1cm4gJ2RhdGE6aW1hZ2UvanBlZztiYXNlNjQsJyArIHRoaXMuZW5jb2RlNjQoaW1hZ2UpO1xyXG4gIH07XHJcblxyXG5cclxuICBFeGlmUmVzdG9yZXIuZXhpZk1hbmlwdWxhdGlvbiA9IGZ1bmN0aW9uIChyZXNpemVkRmlsZUJhc2U2NDphbnksIHNlZ21lbnRzOmFueSkge1xyXG4gICAgdmFyIGV4aWZBcnJheSA9IHRoaXMuZ2V0RXhpZkFycmF5KHNlZ21lbnRzKSxcclxuICAgICAgbmV3SW1hZ2VBcnJheSA9IHRoaXMuaW5zZXJ0RXhpZihyZXNpemVkRmlsZUJhc2U2NCwgZXhpZkFycmF5KTtcclxuICAgIHJldHVybiBuZXcgVWludDhBcnJheShuZXdJbWFnZUFycmF5KTtcclxuICB9O1xyXG5cclxuICBFeGlmUmVzdG9yZXIuZ2V0RXhpZkFycmF5ID0gZnVuY3Rpb24gKHNlZ21lbnRzOm51bWJlcltdW10pIHtcclxuICAgIHZhciBzZWc7XHJcbiAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHNlZ21lbnRzLmxlbmd0aDsgeCsrKSB7XHJcbiAgICAgIHNlZyA9IHNlZ21lbnRzW3hdO1xyXG4gICAgICBpZiAoc2VnWzBdID09PSAyNTUgJiYgc2VnWzFdID09PSAyMjUpIC8vKGZmIGUxKVxyXG4gICAgICB7XHJcbiAgICAgICAgcmV0dXJuIHNlZztcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIFtdO1xyXG4gIH07XHJcblxyXG5cclxuICBFeGlmUmVzdG9yZXIuaW5zZXJ0RXhpZiA9IGZ1bmN0aW9uIChyZXNpemVkRmlsZUJhc2U2NDphbnksIGV4aWZBcnJheTphbnkpIHtcclxuICAgIHZhciBpbWFnZURhdGEgPSByZXNpemVkRmlsZUJhc2U2NC5yZXBsYWNlKCdkYXRhOmltYWdlL2pwZWc7YmFzZTY0LCcsICcnKSxcclxuICAgICAgYnVmID0gdGhpcy5kZWNvZGU2NChpbWFnZURhdGEpLFxyXG4gICAgICBzZXBhcmF0ZVBvaW50ID0gYnVmLmluZGV4T2YoMjU1LCAzKSxcclxuICAgICAgbWFlID0gYnVmLnNsaWNlKDAsIHNlcGFyYXRlUG9pbnQpLFxyXG4gICAgICBhdG8gPSBidWYuc2xpY2Uoc2VwYXJhdGVQb2ludCksXHJcbiAgICAgIGFycmF5ID0gbWFlO1xyXG5cclxuICAgIGFycmF5ID0gYXJyYXkuY29uY2F0KGV4aWZBcnJheSk7XHJcbiAgICBhcnJheSA9IGFycmF5LmNvbmNhdChhdG8pO1xyXG4gICAgcmV0dXJuIGFycmF5O1xyXG4gIH07XHJcblxyXG5cclxuICBFeGlmUmVzdG9yZXIuc2xpY2UyU2VnbWVudHMgPSBmdW5jdGlvbihcclxuICAgIHJhd0ltYWdlQXJyYXk6bnVtYmVyW11cclxuICApIHtcclxuICAgIHZhciBoZWFkOm51bWJlciA9IDAsXHJcbiAgICAgIHNlZ21lbnRzOm51bWJlcltdW10gPSBbXTtcclxuXHJcbiAgICB3aGlsZSAoMSkge1xyXG4gICAgICBpZiAocmF3SW1hZ2VBcnJheVtoZWFkXSA9PT0gMjU1ICYmIHJhd0ltYWdlQXJyYXlbaGVhZCArIDFdID09PSAyMTgpIHtcclxuICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgICBpZiAocmF3SW1hZ2VBcnJheVtoZWFkXSA9PT0gMjU1ICYmIHJhd0ltYWdlQXJyYXlbaGVhZCArIDFdID09PSAyMTYpIHtcclxuICAgICAgICBoZWFkICs9IDI7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgdmFyIGxlbmd0aCA9IHJhd0ltYWdlQXJyYXlbaGVhZCArIDJdICogMjU2ICsgcmF3SW1hZ2VBcnJheVtoZWFkICsgM11cclxuICAgICAgICB2YXIgZW5kUG9pbnQgPSBoZWFkICsgbGVuZ3RoICsgMlxyXG4gICAgICAgIHZhciBzZWc6bnVtYmVyW10gPSByYXdJbWFnZUFycmF5LnNsaWNlKGhlYWQsIGVuZFBvaW50KVxyXG4gICAgICAgIHNlZ21lbnRzLnB1c2goc2VnKTtcclxuICAgICAgICBoZWFkID0gZW5kUG9pbnQ7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGhlYWQgPiByYXdJbWFnZUFycmF5Lmxlbmd0aCkge1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHNlZ21lbnRzO1xyXG4gIH07XHJcblxyXG5cclxuICBFeGlmUmVzdG9yZXIuZGVjb2RlNjQgPSBmdW5jdGlvbiAoXHJcbiAgICBpbnB1dDphbnlcclxuICApOm51bWJlcltde1xyXG4gICAgdmFyIGNocjEsIGNocjIsIGNocjM6YW55ID0gJycsXHJcbiAgICAgIGVuYzEsIGVuYzIsIGVuYzMsIGVuYzQ6YW55ID0gJycsXHJcbiAgICAgIGkgPSAwLFxyXG4gICAgICBidWY6bnVtYmVyW10gPSBbXTtcclxuXHJcbiAgICAvLyByZW1vdmUgYWxsIGNoYXJhY3RlcnMgdGhhdCBhcmUgbm90IEEtWiwgYS16LCAwLTksICssIC8sIG9yID1cclxuICAgIHZhciBiYXNlNjR0ZXN0ID0gL1teQS1aYS16MC05XFwrXFwvXFw9XS9nO1xyXG4gICAgaWYgKGJhc2U2NHRlc3QuZXhlYyhpbnB1dCkpIHtcclxuICAgICAgY29uc29sZS5sb2coJ1RoZXJlIHdlcmUgaW52YWxpZCBiYXNlNjQgY2hhcmFjdGVycyBpbiB0aGUgaW5wdXQgdGV4dC4nKTtcclxuICAgIH1cclxuICAgIGlucHV0ID0gaW5wdXQucmVwbGFjZSgvW15BLVphLXowLTlcXCtcXC9cXD1dL2csICcnKTtcclxuXHJcbiAgICBkbyB7XHJcbiAgICAgIGVuYzEgPSB0aGlzLktFWV9TVFIuaW5kZXhPZihpbnB1dC5jaGFyQXQoaSsrKSk7XHJcbiAgICAgIGVuYzIgPSB0aGlzLktFWV9TVFIuaW5kZXhPZihpbnB1dC5jaGFyQXQoaSsrKSk7XHJcbiAgICAgIGVuYzMgPSB0aGlzLktFWV9TVFIuaW5kZXhPZihpbnB1dC5jaGFyQXQoaSsrKSk7XHJcbiAgICAgIGVuYzQgPSB0aGlzLktFWV9TVFIuaW5kZXhPZihpbnB1dC5jaGFyQXQoaSsrKSk7XHJcblxyXG4gICAgICBjaHIxID0gKGVuYzEgPDwgMikgfCAoZW5jMiA+PiA0KTtcclxuICAgICAgY2hyMiA9ICgoZW5jMiAmIDE1KSA8PCA0KSB8IChlbmMzID4+IDIpO1xyXG4gICAgICBjaHIzID0gKChlbmMzICYgMykgPDwgNikgfCBlbmM0O1xyXG5cclxuICAgICAgYnVmLnB1c2goY2hyMSk7XHJcblxyXG4gICAgICBpZiAoZW5jMyAhPT0gNjQpIHtcclxuICAgICAgICBidWYucHVzaChjaHIyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoZW5jNCAhPT0gNjQpIHtcclxuICAgICAgICBidWYucHVzaChjaHIzKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY2hyMSA9IGNocjIgPSBjaHIzID0gJyc7XHJcbiAgICAgIGVuYzEgPSBlbmMyID0gZW5jMyA9IGVuYzQgPSAnJztcclxuXHJcbiAgICB9IHdoaWxlIChpIDwgaW5wdXQubGVuZ3RoKTtcclxuXHJcbiAgICByZXR1cm4gYnVmO1xyXG4gIH07XHJcblxyXG4gIHJldHVybiBFeGlmUmVzdG9yZXIucmVzdG9yZShvcmlnLCByZXNpemVkKTsgIC8vPD0gRVhJRlxyXG59O1xyXG4iXX0=